Metadata-Version: 2.4
Name: image-convert-mcp
Version: 0.2.0
Summary: A Model Context Protocol server for image format conversion
Author: Dinesh Puthiyedath
License: MIT
Requires-Python: >=3.11
Description-Content-Type: text/markdown
Requires-Dist: mcp>=1.0.0
Requires-Dist: pillow>=10.0.0
Requires-Dist: pillow-avif-plugin>=1.4.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"

# Image Convert MCP Server

A Model Context Protocol (MCP) server for high-performance image format conversion supporting WebP and AVIF formats with parallel processing capabilities.

## ğŸš€ Features

- **Multiple Format Support**: Convert images to WebP, AVIF, or both formats simultaneously
- **Batch Processing**: Process entire directories with configurable parallel workers
- **Image Resizing**: Optional width/height constraints with aspect ratio preservation
- **Quality Control**: Configurable quality settings for both WebP and AVIF
- **High Performance**: Multi-process parallel execution for batch operations
- **Flexible Input**: Supports PNG, JPG, JPEG, TIFF, BMP, and WebP as input formats

## ğŸ“‹ Requirements

- Python 3.11+
- Pillow (PIL)
- pillow-avif-plugin
- libavif-dev (system dependency)

## ğŸ”§ Installation

### Using pip

```bash
pip install pillow pillow-avif-plugin
```

### Using Docker

```bash
docker build -t image-convert-mcp .
```

## ğŸ“– Usage

The MCP server accepts JSON input via stdin and outputs JSON results via stdout.

### Single Image Conversion

```json
{
  "params": {
    "mode": "single",
    "input_path": "/path/to/image.png",
    "output_dir": "/path/to/output",
    "format": "both",
    "webp_quality": 80,
    "avif_quality": 50,
    "lossless": false,
    "max_width": 1920,
    "max_height": 1080
  }
}
```

### Batch Conversion

```json
{
  "params": {
    "mode": "batch",
    "input_path": "/path/to/images/directory",
    "output_dir": "/path/to/output",
    "format": "webp",
    "webp_quality": 85,
    "workers": 4
  }
}
```

## ğŸ”‘ Parameters

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `mode` | string | `"single"` | Processing mode: `"single"` or `"batch"` |
| `input_path` | string | **required** | Path to image file (single mode) or directory (batch mode) |
| `output_dir` | string | parent of input | Directory for output files |
| `format` | string | `"both"` | Output format: `"webp"`, `"avif"`, or `"both"` |
| `webp_quality` | int | `80` | WebP quality (1-100) |
| `avif_quality` | int | `50` | AVIF quality (1-100) |
| `lossless` | bool | `false` | Enable lossless compression for WebP |
| `max_width` | int | `null` | Maximum output width (maintains aspect ratio) |
| `max_height` | int | `null` | Maximum output height (maintains aspect ratio) |
| `workers` | int | CPU count | Number of parallel workers (batch mode only) |

## ğŸ³ Docker Usage

```bash
# Build the image
docker build -t image-convert-mcp .

# Run conversion
echo '{"params":{"input_path":"/app/input.png","format":"webp"}}' | \
  docker run -i -v /path/to/images:/app image-convert-mcp
```

## ğŸ”Œ MCP Configuration

Add to your MCP settings file (e.g., `opencode.json`):

```json
{
  "mcpServers": {
    "image-convert": {
      "command": "python",
      "args": ["/path/to/image-convert-mcp/mcp_server.py"],
      "disabled": false
    }
  }
}
```

Or using Docker:

```json
{
  "mcpServers": {
    "image-convert": {
      "command": "docker",
      "args": [
        "run",
        "-i",
        "--rm",
        "-v",
        "${workspaceFolder}:/workspace",
        "image-convert-mcp"
      ],
      "disabled": false
    }
  }
}
```

## ğŸ“Š Output Format

### Single Mode
```json
{
  "result": {
    "input": "/path/to/input.png",
    "webp": "/path/to/output/input.webp",
    "avif": "/path/to/output/input.avif"
  }
}
```

### Batch Mode
```json
{
  "result": [
    {
      "input": "/path/to/image1.png",
      "webp": "/path/to/output/image1.webp"
    },
    {
      "input": "/path/to/image2.jpg",
      "webp": "/path/to/output/image2.webp"
    }
  ]
}
```

## ğŸ¯ Supported Input Formats

- PNG (`.png`)
- JPEG (`.jpg`, `.jpeg`)
- TIFF (`.tiff`)
- BMP (`.bmp`)
- WebP (`.webp`)

## ğŸ› ï¸ Development

### Project Structure
```
image-convert-mcp/
â”œâ”€â”€ mcp_server.py      # Main MCP server implementation
â”œâ”€â”€ requirements.txt   # Python dependencies
â””â”€â”€ Dockerfile         # Docker container definition
```

## ğŸ“ License

MIT License

## ğŸ¤ Contributing

Contributions are welcome! Please feel free to submit issues or pull requests.

## ğŸ”® Roadmap

- [ ] Support for JPEG XL format
- [ ] Metadata preservation options
- [ ] Progress reporting for long operations
- [ ] Comprehensive test suite
- [ ] Input validation and security enhancements
- [ ] Caching for frequently converted images
